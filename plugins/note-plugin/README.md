# 笔记插件 - 多人协作文档管理

## 功能特性

### 📝 基础功能
- **笔记管理**: 创建、编辑、删除笔记
- **实时保存**: 自动保存功能，防止数据丢失
- **搜索功能**: 快速搜索笔记内容
- **分类管理**: 支持笔记分类整理

### 🤝 协作功能
- **P2P协作**: 基于libp2p的去中心化协作
- **实时同步**: 多人同时编辑，实时同步更改
- **局域网分享**: 在局域网内分享笔记给其他用户
- **冲突解决**: 智能处理编辑冲突

### 🔒 数据安全
- **本地存储**: 数据存储在本地，保护隐私
- **权限控制**: 支持读写权限管理
- **版本控制**: 记录笔记修改历史

## 技术架构

### 前端技术
- **HTML5 + CSS3**: 现代化UI界面
- **原生JavaScript**: 轻量级，无框架依赖
- **响应式设计**: 适配不同屏幕尺寸

### 后端集成
- **Electron IPC**: 与主进程通信
- **SQLite数据库**: 本地数据持久化
- **P2P网络**: libp2p实现去中心化通信

### 协作机制
- **操作队列**: 记录编辑操作，支持协作同步
- **消息广播**: P2P网络广播笔记更新
- **状态管理**: 实时跟踪协作状态

## 使用指南

### 基本操作
1. **创建笔记**: 点击"新建笔记"按钮
2. **编辑笔记**: 在右侧编辑器中输入内容
3. **保存笔记**: 自动保存或点击"保存"按钮
4. **搜索笔记**: 在搜索框中输入关键词

### 协作功能
1. **启用协作**: 点击"启用协作"按钮
2. **分享笔记**: 选择笔记后点击"分享笔记"
3. **接收分享**: 自动接收局域网内的共享笔记
4. **实时编辑**: 多人同时编辑时会实时同步

### 状态指示
- **绿色徽章**: 已分享的笔记
- **蓝色徽章**: 来自其他用户的远程笔记
- **协作状态**: 显示当前协作模式状态

## 文件结构

```
note-plugin/
├── index.html          # 主界面HTML
├── script.js           # 核心JavaScript逻辑
├── style.css           # 样式文件
├── cubeModule.json     # 插件配置
└── README.md           # 说明文档
```

## 核心类和方法

### NotePlugin类
- `init()`: 初始化插件
- `createNote()`: 创建新笔记
- `saveNotes()`: 保存笔记数据
- `shareCurrentNote()`: 分享当前笔记
- `toggleCollaboration()`: 切换协作模式

### P2P协作方法
- `initializeP2PCollaboration()`: 初始化P2P协作
- `broadcastNoteShare()`: 广播笔记分享
- `handleP2PMessage()`: 处理P2P消息
- `processPendingOperations()`: 处理待同步操作

## 依赖要求

- **WhyTalk主应用**: 需要在WhyTalk环境中运行
- **P2P服务**: 依赖主应用的P2P网络功能
- **数据服务**: 使用主应用的插件数据服务

## 开发说明

### 本地开发
1. 确保WhyTalk主应用正常运行
2. 修改插件代码后重新加载插件
3. 使用浏览器开发者工具调试

### 扩展功能
- 可以添加更多编辑器功能（如Markdown支持）
- 可以集成更多协作工具
- 可以添加文件附件功能

## 注意事项

1. **网络环境**: P2P功能需要良好的网络环境
2. **防火墙**: 可能需要配置防火墙允许P2P通信
3. **数据备份**: 建议定期备份重要笔记
4. **性能优化**: 大量笔记时可能需要分页加载

## 更新日志

### v1.0.0
- ✅ 基础笔记管理功能
- ✅ P2P协作支持
- ✅ 局域网分享功能
- ✅ 实时同步机制
- ✅ 现代化UI界面

## 技术参考

本插件参考了以下开源项目的设计理念：
- **AFFiNE**: 下一代知识库，注重隐私和协作
- **libp2p**: 去中心化网络协议栈
- **CRDTs**: 冲突无关复制数据类型

## 许可证

本插件遵循MIT许可证，可自由使用和修改。