<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>插件配置窗口测试</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }
      .title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
      }
      .controls {
        display: flex;
        gap: 10px;
      }
      button {
        padding: 8px 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background: white;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #f0f0f0;
      }
      .primary {
        background: #007bff;
        color: white;
        border-color: #007bff;
      }
      .primary:hover {
        background: #0056b3;
      }
      .danger {
        background: #dc3545;
        color: white;
        border-color: #dc3545;
      }
      .danger:hover {
        background: #c82333;
      }
      .content {
        margin-top: 20px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #555;
      }
      input,
      textarea,
      select {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
      }
      textarea {
        height: 80px;
        resize: vertical;
      }
      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .checkbox-group input[type='checkbox'] {
        width: auto;
      }
      .status {
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 15px;
      }
      .status.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .actions {
        margin-top: 20px;
        text-align: center;
        padding-top: 15px;
        border-top: 1px solid #eee;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="title">插件配置 - 测试插件</div>
        <div class="controls">
          <button onclick="minimizeWindow()">最小化</button>
          <button onclick="maximizeWindow()">最大化</button>
          <button onclick="closeWindow()" class="danger">关闭</button>
        </div>
      </div>

      <div class="content">
        <div id="status" class="status success" style="display: none"></div>

        <div class="form-group">
          <label for="pluginName">插件名称</label>
          <input type="text" id="pluginName" value="测试插件" readonly />
        </div>

        <div class="form-group">
          <label for="pluginVersion">版本</label>
          <input type="text" id="pluginVersion" value="1.0.0" readonly />
        </div>

        <div class="form-group">
          <label for="apiKey">API密钥</label>
          <input type="password" id="apiKey" placeholder="请输入API密钥" />
        </div>

        <div class="form-group">
          <label for="serverUrl">服务器地址</label>
          <input
            type="url"
            id="serverUrl"
            placeholder="https://api.example.com"
            value="https://api.example.com"
          />
        </div>

        <div class="form-group">
          <label for="timeout">超时时间（秒）</label>
          <input type="number" id="timeout" min="1" max="300" value="30" />
        </div>

        <div class="form-group">
          <label for="logLevel">日志级别</label>
          <select id="logLevel">
            <option value="debug">调试</option>
            <option value="info" selected>信息</option>
            <option value="warn">警告</option>
            <option value="error">错误</option>
          </select>
        </div>

        <div class="form-group">
          <div class="checkbox-group">
            <input type="checkbox" id="autoStart" checked />
            <label for="autoStart">自动启动</label>
          </div>
        </div>

        <div class="form-group">
          <div class="checkbox-group">
            <input type="checkbox" id="enableNotifications" />
            <label for="enableNotifications">启用通知</label>
          </div>
        </div>

        <div class="form-group">
          <label for="description">描述</label>
          <textarea id="description" placeholder="插件描述信息...">
这是一个测试插件，用于验证配置窗口功能。</textarea
          >
        </div>
      </div>

      <div class="actions">
        <button onclick="saveConfig()" class="primary">保存配置</button>
        <button onclick="resetConfig()">重置</button>
        <button onclick="testConnection()">测试连接</button>
      </div>
    </div>

    <script>
      // 窗口控制函数
      function minimizeWindow() {
        if (window.pluginAPI && window.pluginAPI.window) {
          window.pluginAPI.window.minimize()
          showStatus('窗口已最小化', 'success')
        } else {
          console.log('最小化窗口（模拟）')
          showStatus('最小化功能（模拟模式）', 'success')
        }
      }

      function maximizeWindow() {
        if (window.pluginAPI && window.pluginAPI.window) {
          window.pluginAPI.window.maximize()
          showStatus('窗口已最大化', 'success')
        } else {
          console.log('最大化窗口（模拟）')
          showStatus('最大化功能（模拟模式）', 'success')
        }
      }

      function closeWindow() {
        if (window.pluginAPI && window.pluginAPI.window) {
          window.pluginAPI.window.close()
        } else {
          console.log('关闭窗口（模拟）')
          if (confirm('确定要关闭窗口吗？')) {
            window.close()
          }
        }
      }

      // 配置管理函数
      function saveConfig() {
        const config = {
          apiKey: document.getElementById('apiKey').value,
          serverUrl: document.getElementById('serverUrl').value,
          timeout: parseInt(document.getElementById('timeout').value),
          logLevel: document.getElementById('logLevel').value,
          autoStart: document.getElementById('autoStart').checked,
          enableNotifications: document.getElementById('enableNotifications').checked,
          description: document.getElementById('description').value
        }

        console.log('保存配置:', config)

        // 模拟保存过程
        setTimeout(() => {
          showStatus('配置保存成功！', 'success')
        }, 500)
      }

      function resetConfig() {
        document.getElementById('apiKey').value = ''
        document.getElementById('serverUrl').value = 'https://api.example.com'
        document.getElementById('timeout').value = '30'
        document.getElementById('logLevel').value = 'info'
        document.getElementById('autoStart').checked = true
        document.getElementById('enableNotifications').checked = false
        document.getElementById('description').value = '这是一个测试插件，用于验证配置窗口功能。'

        showStatus('配置已重置', 'success')
      }

      function testConnection() {
        const serverUrl = document.getElementById('serverUrl').value

        if (!serverUrl) {
          showStatus('请先输入服务器地址', 'error')
          return
        }

        showStatus('正在测试连接...', 'success')

        // 模拟连接测试
        setTimeout(() => {
          const success = Math.random() > 0.3 // 70% 成功率
          if (success) {
            showStatus('连接测试成功！', 'success')
          } else {
            showStatus('连接测试失败，请检查服务器地址和网络连接', 'error')
          }
        }, 2000)
      }

      function showStatus(message, type) {
        const statusEl = document.getElementById('status')
        statusEl.textContent = message
        statusEl.className = `status ${type}`
        statusEl.style.display = 'block'

        // 3秒后自动隐藏
        setTimeout(() => {
          statusEl.style.display = 'none'
        }, 3000)
      }

      // 页面加载完成后的初始化
      document.addEventListener('DOMContentLoaded', function () {
        console.log('插件配置页面已加载')
        console.log('pluginAPI 可用性:', !!window.pluginAPI)

        if (window.pluginAPI) {
          console.log('pluginAPI 对象:', window.pluginAPI)
          console.log('window API 可用性:', !!window.pluginAPI.window)
        }

        showStatus('配置页面加载完成', 'success')
      })

      // 键盘快捷键
      document.addEventListener('keydown', function (e) {
        if (e.ctrlKey || e.metaKey) {
          switch (e.key) {
            case 's':
              e.preventDefault()
              saveConfig()
              break
            case 'r':
              e.preventDefault()
              resetConfig()
              break
            case 'w':
              e.preventDefault()
              closeWindow()
              break
          }
        }
      })
    </script>
  </body>
</html>
